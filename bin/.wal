#!/bin/sh
set -e

if [[ -z $DOTFILES ]]
then
    echo "\$DOTFILES not set"
    exit 1
fi

if [[ -z $1 ]]
then
    echo "Usage: $0 path/to/image.jpg -- [wal options]"
    exit 1
fi

dest_walpaper="$DOTFILES/wallpaper.${1##*.}"
rm "$DOTFILES/wallpaper.*" -f
cp "$1" "$dest_walpaper"

pushd $DOTFILES

while test -n "$1"
do
  shift
  if test "$1" == "--"
  then
    shift
    break
  fi
done

if [[ -z $1 ]]
then
    wal -n -i "$dest_walpaper" --saturate 0.9
else
    wal -n -i "$dest_walpaper" "$@"
fi

nitrogen --head=0 --set-zoom-fill --save "$dest_walpaper"
nitrogen --head=1 --set-zoom-fill --save "$dest_walpaper" 2> /dev/null
nitrogen --head=2 --set-zoom-fill --save "$dest_walpaper" 2> /dev/null
nitrogen --head=3 --set-zoom-fill --save "$dest_walpaper" 2> /dev/null

cp "$HOME/.cache/wal/xresources-00-base"      "$DOTFILES/configs/.config/Xresources.d/00-base"
cp "$HOME/.cache/wal/dunstrc"                 "$DOTFILES/configs/.config/dunst/dunstrc"
cp "$HOME/.cache/wal/rofi-my-dark-theme.rasi" "$DOTFILES/configs/.config/rofi/rofi-my-dark-theme.rasi"

$DOTFILES/bin/.reload
popd